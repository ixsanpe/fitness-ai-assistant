# Inference Pipeline Configuration - Milvus Backend
# Production configuration using Milvus vector database

name: "inference_pipeline_prod"
version: "0.1.0"
environment: "production"
seed: 42
log_level: "warning"

device:
  device: "cuda"
  gpu_id: 0
  mixed_precision: true

paths:
  project_root: "."
  data_dir: "data"
  processed_data_dir: "data/processed"
  embeddings_dir: "data/processed/embeddings"
  models_dir: "models"
  results_dir: "results"

dataset_path: "data/processed/exercises_dataset.jsonl"

model:
  model_name: "all-MiniLM-L6-v2"
  embedding_type: "sentence"
  model_path: null
  max_seq_length: 256
  normalize_embeddings: true
  batch_size: 64
  compile_model: true

# Milvus configuration
vector_db:
  backend: "milvus"
  host: "localhost"
  port: 19530
  username: null
  password: null  # Set via FITNESS_AI_VECTOR_DB__PASSWORD env var

  collection_name: "exercises_embeddings"
  vector_field: "embedding"
  dimension: 384  # Dimension for all-MiniLM-L6-v2

  # HNSW index for fast search
  index_type: "HNSW"
  metric_type: "cosine"
  index_params:
    M: 16
    efConstruction: 256

retrieval:
  top_k: 10
  min_score: 0.7
  query_prefix: "search_query: "
  expand_query: false
  reranking_strategy: "cross_encoder"
  reranking_model: "cross-encoder/ms-marco-MiniLM-L-6-v2"
  rerank_top_k: 20
  filters: {}
  return_fields:
    - "name"
    - "description"
    - "combined_text"
    - "image_paths"
  include_vectors: false
  include_scores: true

caching:
  enabled: true
  ttl: 7200
  max_size: 5000
  cache_embeddings: true

enable_api: true
api_host: "0.0.0.0"
api_port: 8080
enable_ui: false  # Disable UI in production

enable_metrics: true
log_queries: true
